import{j as y,t as P,s as M,r,E as L,l as o,M as A,B as N,o as m}from"./index-0825e3d8.js";import{H as T,F as H}from"./WarehouseCard-bd6f0843.js";import{G as g}from"./Grid-570245c1.js";import"./Search-5662a6f0.js";import"./IconSearch-9811dc67.js";import"./SelectMenu-23a8868b.js";import"./Menu-6d6cb670.js";import"./IconChevronDown-ad88ecf9.js";import"./IconSortDescendingLetters-6548cdab.js";const K=()=>{const{lang:s}=y(P),{money:p,name:i}=y(M),[x,v]=r.useState(!1),[u,h]=r.useState([]),[w,d]=r.useState([]),[_,f]=r.useState(!1),[j,b]=r.useState({}),[k,S]=r.useState([]);L("removeStock",t=>{const e=[...u],l=e.findIndex(n=>n.model===t);l!==-1&&(e[l].stock-=1,h(e),d(e.slice(0,100)))});const V=t=>{const e=Object.values(u).filter(l=>t?l.category.toLowerCase().includes(t.toLowerCase()):!0);d(e.slice(0,100))},D=t=>{const e=Object.values(u).filter(l=>t===""?!0:l.label.toLowerCase().includes(t.toLowerCase()));d(e.slice(0,100))},C=(t,e)=>{switch(t){case"order":b({title:s.place_order,options:[{name:"vehicle",type:"text",title:s.veh_model,default:e.label,icon:"fa-regular fa-pen-to-square",disabled:!0},{name:"funds",type:"number",title:s.funds,default:p,icon:"fa-solid fa-coins",disabled:!0},{name:"price",type:"number",title:s.price_unit,default:e.basePrice,icon:"fa-solid fa-tags",disabled:!0},{name:"amount",type:"number",title:s.units,default:0,icon:"fa-solid fa-cart-plus"}],button:s.confirm_button,extraData:{event:"placeOrder",dealer:i,model:e.model,basePrice:e.basePrice,funds:p}}),f(!0);break;case"test":m("av_dealership","testDrive",{model:e.model,dealership:i});break;case"sell":b({title:s.sell_vehicle,options:[{name:"vehicle",type:"text",title:s.veh_model,default:e.label,icon:"fa-regular fa-pen-to-square",disabled:!0},{name:"basePrice",type:"number",title:s.base_price,default:e.basePrice,icon:"fa-solid fa-tags",disabled:!0},{name:"playerId",type:"number",title:s.player_id,default:0,icon:"fa-solid fa-user"},{name:"phone",type:"number",title:s.customer_phone,default:0,icon:"fa-solid fa-phone"},{name:"price",type:"number",title:s.price,default:0,icon:"fa-solid fa-file-invoice-dollar"},{name:"payments",type:"number",title:s.payments,default:1,icon:"fa-solid fa-calendar-days",subtitle:"(max 12)"},{name:"garage",type:"select",title:s.garage,icon:"fa-solid fa-warehouse",options:k,searchable:!0},{type:"info",description:s.sell_confirmation,style:{marginTop:"10px",fontSize:"14px",fontWeight:"500",textAlign:"center"}}],button:s.confirm_button,extraData:{event:"sellVehicle",dealer:i,model:e.model,label:e.label,funds:p,basePrice:e.basePrice}}),f(!0);break}},O=t=>{var e;f(!1),(e=t==null?void 0:t.extraData)!=null&&e.event&&m("av_dealership",t.extraData.event,t)};return r.useEffect(()=>{(async()=>{try{const e=await m("av_dealership","getVehicles",i);v(e.testDrive),S(e.allGarages);const n=Object.values(e.allVehicles).filter(a=>a.dealerships.includes(i)).map(a=>({...a})).map(a=>{const c=e.vehicles.find(G=>G.model===a.model);return c&&c.stock!==void 0?a={...a,stock:c.stock}:a={...a,stock:0},a}).sort((a,c)=>c.stock-a.stock),E={...e.allVehicles};n.forEach(a=>{E[a.model]={...a}}),d(n.slice(0,100)),h(n)}catch(e){console.error("Error fetching or processing data:",e)}})()},[]),o.jsxs("div",{children:[_&&o.jsx(A,{data:j,callback:O}),o.jsx(T,{vehicles:u,handleCategory:V,handleSearch:D}),o.jsx(N,{className:"warehouse-container",style:{height:window.innerHeight/2.05},children:o.jsx(g,{columns:2,children:w.map((t,e)=>o.jsx(g.Col,{className:"warehouse-card",children:o.jsx(H,{data:t,onSelect:C,driveTestOpen:x,lang:s},e)},e))})})]})};export{K as default};
