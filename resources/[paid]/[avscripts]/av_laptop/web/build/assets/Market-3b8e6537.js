import{c as H,j as e,u as E,s as G,y as D,r as g,T as y,z as _,C as $,E as R,H as N,B as F,A as M,L as W,f as P}from"./index-233adb6c.js";import{T as b}from"./Tabs-0516f84b.js";import{G as A}from"./Group-4c6472c6.js";import{F as z}from"./Flex-6b5eab4b.js";import{G as B}from"./Grid-b2161ac1.js";import{A as V}from"./AppShell-ae46d005.js";import{H as q}from"./Header-7f1318d3.js";import{N as J}from"./Navbar-d15a2fa8.js";var K=H("plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]);const Q=({tabOptions:t=[],setCurrentTab:l})=>{var i;const r=s=>{const h=t.find(k=>k.name===s);l(h)};return e.jsx("div",{className:"header",children:e.jsx(b,{onTabChange:s=>{r(s)},radius:"0px",defaultValue:(i=t[0])==null?void 0:i.name,sx:{".mantine-Tabs-tabsList":{border:"none",borderColor:"none"}},children:e.jsx(b.List,{children:t==null?void 0:t.map((s,h)=>e.jsx(b.Tab,{value:s.name,children:s.label},h))})})})},U=({total:t,products:l,handleBuy:r,handleRemove:i})=>{const{lang:s}=E(G),{inventoryPath:h}=E(D),[k,T]=g.useState([]),j=n=>{const m=[...k];l.forEach(w=>{const{account:p,price:a,amount:c}=w,d=m.find(f=>f.account===n.account);d?d.price-=a*c:m.push({account:p,price:a})}),T(m),i(n)};return g.useEffect(()=>{const n=[];l.forEach(m=>{const{account:w,price:p,amount:a}=m,c=n.find(d=>d.account===w);c?c.price+=p*a:n.push({account:w,price:p*a})}),T(n)},[l]),e.jsxs("div",{className:"cart-container",children:[e.jsx("span",{className:"cart-header",children:e.jsx(y,{order:3,children:s.dark_market.shopping_cart})}),e.jsx("div",{className:"cart-list",children:l.map((n,m)=>e.jsxs(A,{spacing:"xs",className:"cart-product",children:[e.jsx(_,{height:35,width:35,src:h?`${`https://cfx-nui-${h}${n==null?void 0:n.name}.png`}`:`blackmarket/${n==null?void 0:n.name}.png`,alt:n==null?void 0:n.name,sx:{backgroundColor:"transparent",alignContent:"center",alignItems:"center"},withPlaceholder:!0}),e.jsxs(z,{gap:"0px",justify:"flex-start",align:"flex-start",direction:"column",wrap:"wrap",style:{display:"flex",textAlign:"left"},w:80,children:[e.jsx($,{weight:500,maw:90,truncate:!0,children:n.label}),e.jsx($,{size:14,truncate:!0,children:`${n.price*n.amount} ${n.account}`})]}),e.jsx(R,{title:"Delete",size:"sm",iconSize:18,onClick:()=>{j(n)},color:"red.3"})]},m))}),e.jsx("div",{className:"cart-footer",children:e.jsxs(A,{spacing:"xs",w:"90%",style:{justifyContent:"center"},children:[e.jsxs(N,{width:"auto",shadow:"sm",withinPortal:!0,children:[e.jsx(N.Target,{children:e.jsx(y,{order:4,children:`${s.dark_market.total}: ${t}`})}),e.jsx(N.Dropdown,{children:k.map((n,m)=>e.jsx("span",{children:e.jsx($,{children:`x${n.price} ${n.account}`})},m))})]}),e.jsx(F,{onClick:r,disabled:!l[0],children:s.dark_market.buy})]})})]})},X=({currentTab:t,handleAdd:l})=>{var i;const{inventoryPath:r}=E(D);return e.jsx("div",{className:"products-container",children:e.jsx("div",{className:"products-list",children:e.jsx(B,{columns:3,children:(i=t==null?void 0:t.items)==null?void 0:i.map(s=>e.jsxs(B.Col,{className:"product-card",children:[e.jsx("span",{className:"product-header",children:e.jsx(y,{order:4,children:s==null?void 0:s.label})}),e.jsx(_,{height:100,width:100,mx:"auto",radius:"md",src:r?`${`https://cfx-nui-${r}${s==null?void 0:s.name}.png`}`:`blackmarket/${s==null?void 0:s.name}.png`,alt:s==null?void 0:s.name,sx:{marginTop:"10px",backgroundColor:"transparent"},withPlaceholder:!0}),e.jsxs("span",{className:"product-footer",children:[e.jsxs(z,{justify:"flex-start",align:"flex-end",direction:"column",wrap:"wrap-reverse",children:[e.jsxs(y,{order:6,children:[e.jsx("a",{children:"Price:"})," ",e.jsx("a",{style:{fontWeight:"400"},children:`${s==null?void 0:s.price} ${s==null?void 0:s.accountLabel}`})]}),e.jsxs(y,{order:6,children:[e.jsx("a",{children:"Stock:"})," ",e.jsx("a",{style:{fontWeight:"400"},children:(s==null?void 0:s.stock)<=0?"0":s.stock})]})]}),e.jsx(M,{sx:{display:"inline-flex",backgroundColor:"#1971C2",":hover":{backgroundColor:"#1C7ED6"}},onClick:()=>{l(s)},disabled:(s==null?void 0:s.stock)<=0,children:e.jsx(K,{size:"1.125rem"})})]})]}))})})})},I=(t,l)=>t.map(i=>{if(i.name===l){const s=i.stock-1;return{...i,stock:s}}return i});const re=()=>{const[t,l]=g.useState([]),[r,i]=g.useState([]),[s,h]=g.useState([]),[k,T]=g.useState(!0),[j,n]=g.useState(0),m=a=>{const c=a.name;if(s.find(f=>f.name===c)){const f=s.map(o=>{if(o.name===c){const L=o.amount+1;return n(j+a.price),{...o,amount:L}}return o}),C=r.items.map(o=>{if(o.name===c){const L=o.stock-1;return{...o,stock:L}}return o});h(f),i({...r,items:C});const x=t.findIndex(o=>o.name===r.name),v=[...t[x].items],S=I(v,c),u=[...t];u[x].items=S,l(u)}else{const f=r.items.map(u=>{if(u.name===c){const o=u.stock-1;return{...u,stock:o}}return u});n(j+a.price),h([...s,{name:c,label:a.label,price:a.price,amount:1,account:a.account,category:r.name}]),i({...r,items:f});const C=t.findIndex(u=>u.name===r.name),x=[...t[C].items],v=I(x,c),S=[...t];S[C].items=v,l(S)}},w=async()=>{await P("av_blackmarket","handleBuy",s)=="ok"&&(h([]),n(0))},p=a=>{if(s.find(d=>d.name===a.name)){const d=s.filter(x=>x.name!==a.name),f=a.price*a.amount,C=r.items.map(x=>{if(x.name===a.name){const v=x.stock+a.amount;return{...x,stock:v}}return x});i({...r,items:C}),h(d),n(j-f)}};return g.useEffect(()=>{(async()=>{const c=await P("av_blackmarket","fetchData");c[0]&&(l(c),i(c[0])),setTimeout(()=>{T(!1)},500)})()},[]),e.jsx(e.Fragment,{children:k?e.jsx("div",{style:{position:"absolute",width:"100%",height:"100%"},children:e.jsx(W,{visible:k,overlayBlur:2,overlayColor:"rgba(20, 21, 23, 1)"})}):e.jsx(V,{header:e.jsx(q,{height:70,children:e.jsx(Q,{tabOptions:t,setCurrentTab:i})}),navbar:e.jsx(J,{width:{base:250},height:"100%",fixed:!1,withBorder:!1,children:e.jsx(U,{total:j,products:s,handleBuy:w,handleRemove:p})}),styles:a=>({main:{backgroundColor:a.colorScheme==="dark"?a.colors.dark[8]:a.colors.gray[0],padding:"10px",marginTop:"75px"}}),sx:{marginTop:"-40px"},children:e.jsx(X,{currentTab:r,handleAdd:m})})})};export{re as default};
